{% extends "base.html" %}

{% block title %}Map Test - Lost and Found{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Map Test Page</h5>
                </div>
                <div class="card-body">
                    <p>This page tests if the map functionality is working correctly.</p>
                    <div class="alert alert-info">
                        <strong>Rinconada Area Focus:</strong> The map is restricted to the Rinconada area in Camarines Sur, 
                        including Iriga City, Baao, Buhi, Nabua, and Bato municipalities.
                    </div>
                    
                    <!-- Map Container -->
                    <div class="mb-3">
                        <label class="form-label">Test Map:</label>
                        <div id="testMap" style="height: 400px; width: 100%; min-height: 400px; background-color: #f8f9fa; border: 1px solid #dee2e6;"></div>
                    </div>
                    
                    <!-- Debug Info -->
                    <div class="mt-3">
                        <h6>Debug Information:</h6>
                        <div id="debugInfo" class="alert alert-info">
                            <p>Checking map initialization...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const debugInfo = document.getElementById('debugInfo');
    
    // Check if Leaflet is loaded
    if (typeof L === 'undefined') {
        debugInfo.innerHTML = '<p class="text-danger">‚ùå Leaflet library not loaded!</p>';
        return;
    }
    
    debugInfo.innerHTML = '<p class="text-success">‚úÖ Leaflet library loaded successfully</p>';
    
    // Check if container exists
    const container = document.getElementById('testMap');
    if (!container) {
        debugInfo.innerHTML += '<p class="text-danger">‚ùå Map container not found!</p>';
        return;
    }
    
    debugInfo.innerHTML += '<p class="text-success">‚úÖ Map container found</p>';
    
    try {
        // Define Rinconada area bounds
        const rinconadaBounds = [
            [13.2, 123.2],  // Southwest corner
            [13.6, 123.7]   // Northeast corner
        ];
        
        // Initialize the map
        const map = L.map('testMap', {
            maxBounds: rinconadaBounds,
            maxBoundsViscosity: 1.0
        }).setView([13.4217, 123.4175], 12); // Iriga City, Rinconada area
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 16
        }).addTo(map);
        
        // Restrict map to Rinconada area bounds
        map.setMaxBounds(rinconadaBounds);
        
        // Add a marker at Iriga City
        const marker = L.marker([13.4217, 123.4175]).addTo(map);
        marker.bindPopup('Iriga City, Rinconada Area - Map is working!').openPopup();
        
        debugInfo.innerHTML += '<p class="text-success">‚úÖ Map initialized successfully!</p>';
        
        // Test click event
        map.on('click', function(e) {
            debugInfo.innerHTML += `<p class="text-info">üìç Map clicked at: ${e.latlng.lat.toFixed(6)}, ${e.latlng.lng.toFixed(6)}</p>`;
        });
        
    } catch (error) {
        debugInfo.innerHTML += `<p class="text-danger">‚ùå Error initializing map: ${error.message}</p>`;
        console.error('Map initialization error:', error);
    }
});
</script>
{% endblock %}
